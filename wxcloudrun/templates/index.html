<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="shortcut icon"
    href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    mce_href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    type="image/x-icon" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <title>商师教务系统课表爬虫</title>
  
  <!-- PyScript CSS -->
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <!-- PyScript JS -->
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  
  <!-- 配置PyScript -->
  <py-config>
    packages = ["pandas", "beautifulsoup4"]
    
    [[fetch]]
    files = ["crawler.py"]
  </py-config>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Droid Sans", "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;
    }

    .title-logo {
      width: 80px;
      height: 80px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @media screen and (min-width:1200px) {
      body .container {
        margin-top: 60px;
        margin-bottom: 100px;
      }
    }

    @media screen and (max-width:1919px) {
      body .container {
        margin-top: 40px;
        margin-bottom: 60px;
      }
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .action-button {
      width: 320px;
      height: 40px;
      box-sizing: border-box;
      margin: 16px 8px;
      font-weight: 500;
      font-size: 17px;
      color: #FFFFFF;
      letter-spacing: 1px;
      text-align: center;
      border-radius: 4px;
    }

    .count-text {
      width: 320px;
      height: 40px;
      padding: 0 12px;
      margin: 0 auto;
      line-height: 40px;
      text-align: left;
      display: flex;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      opacity: 0.9;
      box-sizing: border-box;
      font-weight: 400;
      font-size: 14px;
      color: #000000;
    }

    .title {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      width: 320px;
    }

    .title-text {
      width: 320px;
      height: 48px;
      text-align: center;
      margin-top: 16px;
      font-size: 32px;
      opacity: 0.9;
      font-weight: 500;
      font-size: 32px;
      color: #000000;
      letter-spacing: 0;
      line-height: 48px;
    }

    .crawler-container {
      margin-top: 30px;
      width: 100%;
      max-width: 800px;
    }

    .status-area {
      min-height: 100px;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-top: 20px;
      background-color: #f9f9f9;
      font-family: monospace;
    }

    .login-form {
      margin-top: 20px;
      width: 100%;
      max-width: 400px;
    }

    .result-buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .tab-content {
      padding: 20px 0;
    }
    
    #python-output {
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="title">
      <img class="title-logo"
        src="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg" />
      <div style="display: inline; margin-bottom: 48px" class="title-text">商师教务系统课表爬虫</div>
    </div>

    <div class="crawler-container">
      <div class="alert alert-warning" role="alert">
        <h4 class="alert-heading">运行提示</h4>
        <p>由于浏览器安全限制，在浏览器中运行Python爬虫会受到很多限制，特别是Selenium无法在浏览器中直接运行。此页面将调用一个简化版爬虫程序进行演示。</p>
        <hr>
        <p class="mb-0">如需完整功能，请在本地环境运行Python脚本。</p>
      </div>
      
      <div class="d-grid gap-2">
        <button id="run-crawler" class="btn btn-primary">运行Python爬虫程序</button>
      </div>
      
      <div class="status-area" id="python-output">
        <!-- Python输出将显示在这里 -->
        等待运行Python程序...
      </div>
    </div>
  </div>
  
  <!-- 嵌入简化版本的Python爬虫代码 -->
  <py-script>
# 引入必要的库
import js
from pyodide.ffi import create_proxy
import sys
from io import StringIO

# 重定向标准输出到自定义对象
class OutputCapture:
    def __init__(self):
        self.output = StringIO()
    
    def write(self, text):
        self.output.write(text)
        # 更新HTML上的输出区域
        output_element = js.document.getElementById("python-output")
        if output_element:
            current_text = output_element.textContent
            output_element.textContent = current_text + text
    
    def flush(self):
        pass

# 设置捕获
output_capture = OutputCapture()
sys.stdout = output_capture

# 模拟爬虫程序
def run_simplified_crawler():
    print("正在启动商师教务系统课表爬虫程序...\n")
    
    print("初始化爬虫...\n")
    
    print("注意：完整功能需要在本地环境运行，浏览器环境无法运行Selenium和访问本地文件系统。\n")
    
    print("模拟爬虫流程：")
    print("1. 访问登录页面")
    print("2. 尝试使用Cookies登录")
    print("3. 如果Cookies无效，进行手动登录")
    print("4. 导航到课表页面")
    print("5. 提取课表数据")
    print("6. 保存为Excel文件\n")
    
    print("由于浏览器安全限制，实际爬虫功能无法在此环境运行。")
    print("请在本地Python环境中运行完整的爬虫程序。\n")
    
    print("如需在本地运行，请使用以下步骤：")
    print("1. 确保安装了必要的Python包: pip install pandas selenium beautifulsoup4")
    print("2. 下载适合您系统的Chrome驱动")
    print("3. 在命令行运行: python crawler.py")

# 设置按钮点击事件
def on_button_click(event):
    # 清空输出区域
    js.document.getElementById("python-output").textContent = ""
    # 运行爬虫
    run_simplified_crawler()

# 注册按钮点击事件
button = js.document.getElementById("run-crawler")
click_proxy = create_proxy(on_button_click)
button.addEventListener("click", click_proxy)
  </py-script>
  
</body>

<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</html>
